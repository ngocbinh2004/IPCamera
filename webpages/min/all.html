<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IP Camera – Cài đặt</title>
  <style>*{box-sizing:border-box;margin:0;padding:0}body{background:#f4f6f8;color:#222;display:flex;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;min-height:100vh}.sidebar{background:#1f2329;color:#fff;padding:20px 14px;width:240px}.sidebar-title{font-size:20px;margin-bottom:16px;opacity:.9;text-align:center}.sidebar-btn,.sidebar-logout{background:#2d333b;border:none;border-radius:10px;color:#fff;cursor:pointer;margin-bottom:10px;padding:12px 14px;text-align:left;transition:.2s;width:100%}.sidebar-btn.active{background:#0582ff}.sidebar-btn:hover{transform:translateY(-1px)}.sidebar-logout{background:#e74c3c;font-weight:600;margin-top:12px;text-align:center}.content{flex:1;padding:28px}.card{background:#fff;border-radius:16px;box-shadow:0 10px 24px rgba(0,0,0,.06);padding:24px}.card h2{font-size:28px;margin-bottom:18px}.logging-layout{display:grid;gap:28px;grid-template-columns:180px 1fr}.logging-left{align-items:flex-start;display:flex}.btn-secondary{background:#0ea5e9;border:none;border-radius:10px;color:#fff;font-weight:600;padding:10px 14px}.logging-center{display:flex;flex-direction:column;gap:12px}.level-display{background:#fff;border:3px solid #222;font-size:20px;font-weight:900;letter-spacing:.6px;padding:12px 18px;text-align:center}.level-display,.level-select{border-radius:10px;width:280px}.level-select{border:1px solid #e1e5ea;padding:10px}.logging-actions{display:flex;flex-wrap:wrap;gap:16px;margin-top:10px}.btn-primary{background:#3386ff;border:none;border-radius:10px;color:#fff;cursor:pointer;font-weight:700;padding:12px 18px;transition:transform .05s,opacity .2s}.btn-primary:hover{transform:translateY(-1px)}.btn-muted{opacity:.6}.btn-primary.loading{opacity:.7;pointer-events:none}.settings-row{align-items:center;display:grid;gap:14px;grid-template-columns:180px 1fr;margin:10px 0}.settings-row input{border:1px solid #e1e5ea;border-radius:10px;padding:12px}.log-preview{background:#0f172a;border-radius:12px;color:#e2e8f0;margin-top:16px;max-height:220px;min-height:120px;overflow:auto;padding:14px}.toast{background:#111827;border-radius:10px;bottom:20px;box-shadow:0 10px 20px rgba(0,0,0,.15);color:#fff;opacity:0;padding:10px 14px;pointer-events:none;position:fixed;right:20px;transform:translateY(8px);transition:opacity .2s,transform .2s;z-index:50}.toast.show{opacity:1;transform:translateY(0)}.toast.success{background:#16a34a}.toast.error{background:#dc2626}#login-mount{width:100%}.login-wrap{align-items:center;background:#f4f6f8;display:flex;justify-content:center;min-height:100vh}.login-card{background:#fff;border-radius:16px;box-shadow:0 10px 24px rgba(0,0,0,.06);padding:28px;width:360px}.login-card h1{font-size:24px;margin-bottom:14px}.field{display:flex;flex-direction:column;margin:10px 0}.field input{border:1px solid #e1e5ea;border-radius:10px;padding:12px}.actions{display:flex;gap:10px;margin-top:10px}.btn{background:#3386ff;border:none;border-radius:10px;color:#fff;cursor:pointer;font-weight:700;padding:12px 18px}.login-msg{color:#666;font-size:13px;margin-top:10px}</style>
</head>

<body>
  <aside class="sidebar">
    <h3 class="sidaebar-title">IP Setting</h3>
    <button class="sidebar-btn" data-section="WifiSetup">Wifi Setup</button>
    <button class="sidebar-btn" data-section="FirmwareUpdate">Firmware Update</button>
    <button class="sidebar-btn active" data-section="Logging">Logging</button>
    <button class="sidebar-btn" data-section="SystemInformation">System Information</button>
    <button class="sidebar-logout" id="btnLogout">Đăng xuất</button>
  </aside>

  <main class="content">
    <!-- Wifi Setup -->
    <section id="WifiSetup" class="settings-section" style="display:none">
      <div class="card">
        <h2>Wifi Setup</h2>
        <div class="settings-row">
          <label>SSID</label>
          <input type="text" placeholder="Tên mạng Wi-Fi" />
        </div>
        <div class="settings-row">
          <label>Password</label>
          <input type="password" placeholder="Mật khẩu Wi-Fi" />
        </div>
        <button class="btn-primary">Lưu</button>
      </div>
    </section>

    <!-- Firmware Update -->
    <section id="FirmwareUpdate" class="settings-section" style="display:none">
      <div class="card">
        <h2>Firmware Update</h2>
        <div class="settings-row">
          <label>Chọn tệp</label>
          <input type="file" />
        </div>
        <button class="btn-primary">Cập nhật</button>
      </div>
    </section>

    <!-- Logging (notes removed) -->
    <section id="Logging" class="settings-section">
      <div class="card">
        <h2>Logging</h2>

        <div class="logging-layout">
          <div class="logging-left">
            <button class="btn-secondary" id="btnLevelLabel">Logging Level</button>
          </div>

          <div class="logging-center">
            <div class="level-display" id="levelDisplay">DEBUG</div>
            <select id="levelSelect" class="level-select" aria-label="Chọn mức logging">
              <option value="DEBUG" selected>DEBUG</option>
              <option value="INFO">INFO</option>
              <option value="WARN">WARN</option>
              <option value="ERROR">ERROR</option>
              <option value="FATAL">FATAL</option>
            </select>

            <div class="logging-actions">
              <button class="btn-primary" id="btnStart">Start</button>
              <button class="btn-primary btn-muted" id="btnStop" disabled>Stop</button>
              <button class="btn-primary" id="btnSave">Save Log</button>
            </div>
          </div>
        </div>

        <pre id="logPreview" class="log-preview" aria-label="Xem nhanh log"></pre>
      </div>
    </section>

    <!-- System Information -->
    <section id="SystemInformation" class="settings-section" style="display:none">
      <div class="card">
        <h2>System Information</h2>
        <div class="settings-row"><label>Version</label><input type="text" value="1.0" disabled /></div>
        <div class="settings-row"><label>Address</label><input type="text" value="00:11:22:33:44:55" disabled /></div>
      </div>
    </section>
  </main>

  <!-- Toast for feedback -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>!function(){const e="/api/logging/level",t="/api/logging/start",n="/api/logging/stop",o="/api/logging/download",a="/api/logout",s="/api/login",i=(e,t=document)=>t.querySelector(e),l=(e,t=document)=>Array.from(t.querySelectorAll(e)),c=(e,t="info")=>{const n=i("#toast");n&&(n.textContent=e,n.className=`toast show ${t}`,setTimeout((()=>n.classList.remove("show")),2200))},d=async(e,t={})=>{try{const n=await fetch(e,t);if(!n.ok)throw new Error(n.status+" "+n.statusText);return n}catch(t){return console.warn("API fallback (demo):",e,t.message),{ok:!0,json:async()=>({ok:!0}),blob:async()=>new Blob}}};function r(){const e=i(".sidebar"),t=i(".content");e&&(e.style.display="none"),t&&(t.style.display="none");let n=i("#login-mount");n||(n=document.createElement("div"),n.id="login-mount",document.body.appendChild(n)),n.hidden=!1,n.innerHTML='\n      <div class="login-wrap">\n        <div class="login-card">\n          <h1>Đăng nhập</h1>\n          <div class="field">\n            <label>Username</label>\n            <input id="login-u" type="text" placeholder="admin" />\n          </div>\n          <div class="field">\n            <label>Password</label>\n            <input id="login-p" type="password" placeholder="••••••••" />\n          </div>\n          <div class="actions">\n            <button class="btn" id="btnLogin">Login</button>\n          </div>\n          <p id="login-msg" class="login-msg"></p>\n        </div>\n      </div>\n    ',i("#btnLogin").addEventListener("click",(async()=>{const e=i("#login-u").value.trim(),t=i("#login-p").value;e&&t?(await d(s,{method:"POST",body:JSON.stringify({u:e,p:t})}),localStorage.setItem("token","dummy"),location.hash="#/home",n.hidden=!0,g()):i("#login-msg").textContent="Vui lòng nhập đủ thông tin"}))}function g(){const s=i(".sidebar"),g=i(".content");s&&(s.style.display=""),g&&(g.style.display="");const u=i("#login-mount");u&&(u.hidden=!0),function(){const e=i("#btnLogout");if(!e)return;e.replaceWith(e.cloneNode(!0));const t=i("#btnLogout");t.addEventListener("click",(async()=>{try{t.disabled=!0,t.classList.add("loading")}catch{}try{await fetch(a,{method:"POST"})}catch{}try{localStorage.clear(),sessionStorage.clear()}catch{}location.hash="#/login",r()}))}(),function(){const e=l(".sidebar-btn"),t=l(".settings-section");if(!e.length||!t.length)return;e.forEach((e=>{e.replaceWith(e.cloneNode(!0))}));const n=l(".sidebar-btn");n.forEach((e=>{e.addEventListener("click",(function(){n.forEach((e=>e.classList.remove("active"))),this.classList.add("active"),t.forEach((e=>e.style.display="none"));const e=this.dataset.section,o=document.getElementById(e);o&&(o.style.display="")}))}))}(),function(){const a=i("#levelSelect"),s=i("#levelDisplay"),l=i("#btnStart"),r=i("#btnStop"),g=i("#btnSave"),u=i("#logPreview");if(!(a&&l&&r&&g))return;a.replaceWith(a.cloneNode(!0)),l.replaceWith(l.cloneNode(!0)),r.replaceWith(r.cloneNode(!0)),g.replaceWith(g.cloneNode(!0));const h=i("#levelSelect"),b=i("#btnStart"),p=i("#btnStop"),m=i("#btnSave");let v=!1,y=null,f=[];const L=e=>{const t=`[${(new Date).toISOString()}] [${s.textContent.trim()}] ${e}`;f.push(t),f.length>500&&f.shift(),u.textContent=f.slice(-20).join("\n")};h.addEventListener("change",(async()=>{const t=h.value;s.textContent=t,L(`Logging level set to ${t}`);const n=await d(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:t})});c(n.ok?"Set level OK":"Set level failed",n.ok?"success":"error")})),b.addEventListener("click",(async()=>{if(v)return;b.disabled=!0,b.classList.add("loading");const e=await d(t,{method:"POST"});if(b.classList.remove("loading"),!e.ok)return b.disabled=!1,void c("Start failed","error");v=!0,p.disabled=!1,p.classList.remove("btn-muted"),L("Start logging to debug.log"),y=setInterval((()=>L("IP camera heartbeat")),1500),c("Logging started","success")})),p.addEventListener("click",(async()=>{if(!v)return;p.classList.add("loading");const e=await d(n,{method:"POST"});p.classList.remove("loading"),e.ok?(v=!1,b.disabled=!1,p.disabled=!0,p.classList.add("btn-muted"),y&&clearInterval(y),L("Stop logging to debug.log"),c("Logging stopped","success")):c("Stop failed","error")})),m.addEventListener("click",(async()=>{try{const e=await d(o);if(!e||!e.blob||e instanceof Response){const t=await e.blob(),n=URL.createObjectURL(t),o=Object.assign(document.createElement("a"),{href:n,download:"debug.log"});document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(n)}else{const e=new Blob([f.join("\n")],{type:"text/plain;charset=utf-8"}),t=URL.createObjectURL(e),n=Object.assign(document.createElement("a"),{href:t,download:"debug.log"});document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(t)}c("Log saved","success")}catch{c("Save failed","error")}}))}()}function u(){localStorage.getItem("token")&&"#/login"!==location.hash?g():r()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u(),window.addEventListener("hashchange",u)}();</script>
</body>

</html>