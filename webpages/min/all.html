<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IP Camera – Cài đặt</title>
  <style>*{box-sizing:border-box;margin:0;padding:0}body{background:#f4f6f8;color:#222;display:flex;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;min-height:100vh}.sidebar{background:#1f2329;color:#fff;padding:20px 14px;width:240px}.sidebar-title{font-size:20px;margin-bottom:16px;opacity:.9;text-align:center}.sidebar-btn,.sidebar-logout{background:#2d333b;border:none;border-radius:10px;color:#fff;cursor:pointer;margin-bottom:10px;padding:12px 14px;text-align:left;transition:.2s;width:100%}.sidebar-btn.active{background:#0582ff}.sidebar-btn:hover{transform:translateY(-1px)}.sidebar-logout{background:#e74c3c;font-weight:600;margin-top:12px;text-align:center}.content{flex:1;padding:28px}.card{background:#fff;border-radius:16px;box-shadow:0 10px 24px rgba(0,0,0,.06);padding:24px}.card h2{font-size:28px;margin-bottom:18px}.logging-layout{display:grid;gap:28px;grid-template-columns:180px 1fr}.logging-left{align-items:flex-start;display:flex}.btn-secondary{background:#0ea5e9;border:none;border-radius:10px;color:#fff;font-weight:600;padding:10px 14px}.logging-center{display:flex;flex-direction:column;gap:12px}.level-display{background:#fff;border:3px solid #222;font-size:20px;font-weight:900;letter-spacing:.6px;padding:12px 18px;text-align:center}.level-display,.level-select{border-radius:10px;width:280px}.level-select{border:1px solid #e1e5ea;padding:10px}.logging-actions{display:flex;flex-wrap:wrap;gap:16px;margin-top:10px}.btn-primary{background:#3386ff;border:none;border-radius:10px;color:#fff;cursor:pointer;font-weight:700;padding:12px 18px;transition:transform .05s,opacity .2s}.btn-primary:hover{transform:translateY(-1px)}.btn-muted{opacity:.6}.btn-primary.loading{opacity:.7;pointer-events:none}.settings-row{align-items:center;display:grid;gap:14px;grid-template-columns:180px 1fr;margin:10px 0}.settings-row input{border:1px solid #e1e5ea;border-radius:10px;padding:12px}.log-preview{background:#0f172a;border-radius:12px;color:#e2e8f0;margin-top:16px;max-height:220px;min-height:120px;overflow:auto;padding:14px}.toast{background:#111827;border-radius:10px;bottom:20px;box-shadow:0 10px 20px rgba(0,0,0,.15);color:#fff;opacity:0;padding:10px 14px;pointer-events:none;position:fixed;right:20px;transform:translateY(8px);transition:opacity .2s,transform .2s;z-index:50}.toast.show{opacity:1;transform:translateY(0)}.toast.success{background:#16a34a}.toast.error{background:#dc2626}#login-mount{width:100%}.login-wrap{align-items:center;background:#f4f6f8;display:flex;justify-content:center;min-height:100vh}.login-card{background:#fff;border-radius:16px;box-shadow:0 10px 24px rgba(0,0,0,.06);padding:28px;width:360px}.login-card h1{font-size:24px;margin-bottom:14px}.field{display:flex;flex-direction:column;margin:10px 0}.field input{border:1px solid #e1e5ea;border-radius:10px;padding:12px}.actions{display:flex;gap:10px;margin-top:10px}.btn{background:#3386ff;border:none;border-radius:10px;color:#fff;cursor:pointer;font-weight:700;padding:12px 18px}.login-msg{color:#666;font-size:13px;margin-top:10px}</style>

</head>

<body>
  <aside class="sidebar">
    <h3 class="sidaebar-title">IP Setting</h3>
    <button class="sidebar-btn" data-section="WifiSetup">Wifi Setup</button>
    <button class="sidebar-btn" data-section="FirmwareUpdate">Firmware Update</button>
    <button class="sidebar-btn active" data-section="Logging">Logging</button>
    <button class="sidebar-btn" data-section="SystemInformation">System Information</button>
    <button class="sidebar-logout" id="btnLogout">Đăng xuất</button>
  </aside>

  <main class="content">
    <!-- Wifi Setup -->
    <section id="WifiSetup" class="settings-section" style="display:none">
      <div class="card">
        <h2>Wifi Setup</h2>

        <div class="settings-row">
          <label>SSID</label>
          <select id="ssidSelect">
            <option value="">Chọn mạng Wi-Fi</option>
          </select>
        </div>

        <div class="settings-row">
          <label>Password</label>
          <input id="wifiPwd" type="password" placeholder="Mật khẩu Wi-Fi" />
        </div>

        <div class="btn-row">
          <button class="btn-primary" id="btnWifiScan">Scan</button>
          <button class="btn-primary" id="btnWifiSave">Save</button>
          <button class="btn-primary" id="btnWifiRequest">Request</button>
        </div>
      </div>
    </section>


    <!-- Firmware Update -->
    <section id="FirmwareUpdate" class="settings-section" style="display:none">
      <div class="card">
        <h2>Firmware Update</h2>
        <div class="settings-row">
          <label>Chọn tệp</label>
          <input type="file" />
        </div>
        <button class="btn-primary">Cập nhật</button>
      </div>
    </section>

    <!-- Logging (notes removed) -->
    <section id="Logging" class="settings-section">
      <div class="card">
        <h2>Logging</h2>

        <div class="logging-layout">
          <div class="logging-left">
            <button class="btn-secondary" id="btnLevelLabel">Logging Level</button>
          </div>

          <div class="logging-center">
            <select id="levelSelect" class="level-select" aria-label="Chọn mức logging">
              <option value="DEBUG" selected>DEBUG</option>
              <option value="INFO">INFO</option>
              <option value="WARN">WARN</option>
              <option value="ERROR">ERROR</option>
              <option value="FATAL">FATAL</option>
            </select>

            <div class="logging-actions">
              <button class="btn-primary" id="btnStart">Start</button>
              <button class="btn-primary btn-muted" id="btnStop" disabled>Stop</button>
              <button class="btn-primary" id="btnSave">Save Log</button>
            </div>
          </div>
        </div>

        <pre id="logPreview" class="log-preview" aria-label="Xem nhanh log"></pre>
      </div>
    </section>

    <!-- System Information -->
    <section id="SystemInformation" class="settings-section" style="display:none">
      <div class="card">
        <h2>System Information</h2>
        <div class="settings-row"><label>Version</label><input type="text" value="1.0" disabled /></div>
        <div class="settings-row"><label>Address</label><input type="text" value="00:11:22:33:44:55" disabled /></div>
      </div>
    </section>
  </main>

  <!-- Toast for feedback -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>const{response:response}=require("express");!function(){const e="/api/logging/level",t="/api/logging/start",n="/api/logging/stop",o="/api/logging/download",a="/api/logout",s=(e,t=document)=>t.querySelector(e),i=(e,t=document)=>Array.from(t.querySelectorAll(e)),l=(e,t="info")=>{const n=s("#toast");n&&(n.textContent=e,n.className=`toast show ${t}`,setTimeout((()=>n.classList.remove("show")),2200))},c=async(e,t={})=>{try{const n=await fetch(e,t);if(!n.ok)throw new Error(n.status+" "+n.statusText);return n}catch(t){return console.warn("API fallback (demo):",e,t.message),{ok:!0,json:async()=>({ok:!0}),blob:async()=>new Blob}}};function d(){const e=s(".sidebar"),t=s(".content");e&&(e.style.display="none"),t&&(t.style.display="none");let n=s("#login-mount");n||(n=document.createElement("div"),n.id="login-mount",document.body.appendChild(n)),n.hidden=!1,n.innerHTML='\n      <div class="login-wrap">\n        <div class="login-card">\n          <h1>Đăng nhập</h1>\n          <div class="field">\n            <label>Username</label>\n            <input id="login-u" type="text" placeholder="admin" />\n          </div>\n          <div class="field">\n            <label>Password</label>\n            <input id="login-p" type="password" placeholder="••••••••" />\n          </div>\n          <div class="actions">\n            <button class="btn" id="btnLogin">Login</button>\n          </div>\n          <p id="login-msg" class="login-msg"></p>\n        </div>\n      </div>\n    ',s("#btnLogin").addEventListener("click",(async()=>{const e=s("#login-u").value.trim(),t=s("#login-p").value;if(!e||!t)return void(s("#login-msg").textContent="Vui lòng nhập đủ thông tin");const o=`http://192.168.4.1/api/v1/login?username=${e}&password=${t}`;await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{console.log("Sess",e)})).catch((e=>{console.error("Error:",e)})),localStorage.setItem("token","dummy"),location.hash="#/home",n.hidden=!0,r()}))}function r(){const r=s(".sidebar"),g=s(".content");r&&(r.style.display=""),g&&(g.style.display="");const u=s("#login-mount");u&&(u.hidden=!0),function(){const e=s("#btnLogout");if(!e)return;e.replaceWith(e.cloneNode(!0));const t=s("#btnLogout");t.addEventListener("click",(async()=>{try{t.disabled=!0,t.classList.add("loading")}catch{}try{await fetch(a,{method:"POST"})}catch{}try{localStorage.clear(),sessionStorage.clear()}catch{}location.hash="#/login",d()}))}(),function(){const e=i(".sidebar-btn"),t=i(".settings-section");if(!e.length||!t.length)return;e.forEach((e=>{e.replaceWith(e.cloneNode(!0))}));const n=i(".sidebar-btn");n.forEach((e=>{e.addEventListener("click",(function(){n.forEach((e=>e.classList.remove("active"))),this.classList.add("active"),t.forEach((e=>e.style.display="none"));const e=this.dataset.section,o=document.getElementById(e);if(o&&(o.style.display=""),"WifiSetup"===e){const e=document.querySelector("#WifiSetup .btn-primary");e&&e.addEventListener("click",scanWifi)}}))}))}(),function(){const a=s("#levelSelect"),i=s("#levelDisplay"),d=s("#btnStart"),r=s("#btnStop"),g=s("#btnSave"),u=s("#logPreview");if(!(a&&d&&r&&g))return;a.replaceWith(a.cloneNode(!0)),d.replaceWith(d.cloneNode(!0)),r.replaceWith(r.cloneNode(!0)),g.replaceWith(g.cloneNode(!0));const h=s("#levelSelect"),p=s("#btnStart"),b=s("#btnStop"),m=s("#btnSave");let v=!1,y=null,f=[];const L=e=>{const t=`[${(new Date).toISOString()}] [${i.textContent.trim()}] ${e}`;f.push(t),f.length>500&&f.shift(),u.textContent=f.slice(-20).join("\n")};h.addEventListener("change",(async()=>{const t=h.value;i.textContent=t,L(`Logging level set to ${t}`);const n=await c(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:t})});l(n.ok?"Set level OK":"Set level failed",n.ok?"success":"error")})),p.addEventListener("click",(async()=>{if(v)return;p.disabled=!0,p.classList.add("loading");const e=await c(t,{method:"POST"});if(p.classList.remove("loading"),!e.ok)return p.disabled=!1,void l("Start failed","error");v=!0,b.disabled=!1,b.classList.remove("btn-muted"),L("Start logging to debug.log"),y=setInterval((()=>L("IP camera heartbeat")),1500),l("Logging started","success")})),b.addEventListener("click",(async()=>{if(!v)return;b.classList.add("loading");const e=await c(n,{method:"POST"});b.classList.remove("loading"),e.ok?(v=!1,p.disabled=!1,b.disabled=!0,b.classList.add("btn-muted"),y&&clearInterval(y),L("Stop logging to debug.log"),l("Logging stopped","success")):l("Stop failed","error")})),m.addEventListener("click",(async()=>{try{const e=await c(o);if(!e||!e.blob||e instanceof Response){const t=await e.blob(),n=URL.createObjectURL(t),o=Object.assign(document.createElement("a"),{href:n,download:"debug.log"});document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(n)}else{const e=new Blob([f.join("\n")],{type:"text/plain;charset=utf-8"}),t=URL.createObjectURL(e),n=Object.assign(document.createElement("a"),{href:t,download:"debug.log"});document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(t)}l("Log saved","success")}catch{l("Save failed","error")}}))}()}function g(){localStorage.getItem("token")&&"#/login"!==location.hash?r():d()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):g(),window.addEventListener("hashchange",g)}();</script>

</body>

</html>