const{response:response}=require("express");!function(){const e="/api/logging/level",t="/api/logging/start",n="/api/logging/stop",o="/api/logging/download",a="/api/logout",s=(e,t=document)=>t.querySelector(e),i=(e,t=document)=>Array.from(t.querySelectorAll(e)),l=(e,t="info")=>{const n=s("#toast");n&&(n.textContent=e,n.className=`toast show ${t}`,setTimeout((()=>n.classList.remove("show")),2200))},c=async(e,t={})=>{try{const n=await fetch(e,t);if(!n.ok)throw new Error(n.status+" "+n.statusText);return n}catch(t){return console.warn("API fallback (demo):",e,t.message),{ok:!0,json:async()=>({ok:!0}),blob:async()=>new Blob}}};function d(){const e=s(".sidebar"),t=s(".content");e&&(e.style.display="none"),t&&(t.style.display="none");let n=s("#login-mount");n||(n=document.createElement("div"),n.id="login-mount",document.body.appendChild(n)),n.hidden=!1,n.innerHTML='\n      <div class="login-wrap">\n        <div class="login-card">\n          <h1>Đăng nhập</h1>\n          <div class="field">\n            <label>Username</label>\n            <input id="login-u" type="text" placeholder="admin" />\n          </div>\n          <div class="field">\n            <label>Password</label>\n            <input id="login-p" type="password" placeholder="••••••••" />\n          </div>\n          <div class="actions">\n            <button class="btn" id="btnLogin">Login</button>\n          </div>\n          <p id="login-msg" class="login-msg"></p>\n        </div>\n      </div>\n    ',s("#btnLogin").addEventListener("click",(async()=>{const e=s("#login-u").value.trim(),t=s("#login-p").value;if(!e||!t)return void(s("#login-msg").textContent="Vui lòng nhập đủ thông tin");const o=`http://192.168.4.1/api/v1/login?username=${e}&password=${t}`;await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{console.log("Sess",e)})).catch((e=>{console.error("Error:",e)})),localStorage.setItem("token","dummy"),location.hash="#/home",n.hidden=!0,r()}))}function r(){const r=s(".sidebar"),g=s(".content");r&&(r.style.display=""),g&&(g.style.display="");const u=s("#login-mount");u&&(u.hidden=!0),function(){const e=s("#btnLogout");if(!e)return;e.replaceWith(e.cloneNode(!0));const t=s("#btnLogout");t.addEventListener("click",(async()=>{try{t.disabled=!0,t.classList.add("loading")}catch{}try{await fetch(a,{method:"POST"})}catch{}try{localStorage.clear(),sessionStorage.clear()}catch{}location.hash="#/login",d()}))}(),function(){const e=i(".sidebar-btn"),t=i(".settings-section");if(!e.length||!t.length)return;e.forEach((e=>{e.replaceWith(e.cloneNode(!0))}));const n=i(".sidebar-btn");n.forEach((e=>{e.addEventListener("click",(function(){n.forEach((e=>e.classList.remove("active"))),this.classList.add("active"),t.forEach((e=>e.style.display="none"));const e=this.dataset.section,o=document.getElementById(e);if(o&&(o.style.display=""),"WifiSetup"===e){const e=document.querySelector("#WifiSetup .btn-primary");e&&e.addEventListener("click",scanWifi)}}))}))}(),function(){const a=s("#levelSelect"),i=s("#levelDisplay"),d=s("#btnStart"),r=s("#btnStop"),g=s("#btnSave"),u=s("#logPreview");if(!(a&&d&&r&&g))return;a.replaceWith(a.cloneNode(!0)),d.replaceWith(d.cloneNode(!0)),r.replaceWith(r.cloneNode(!0)),g.replaceWith(g.cloneNode(!0));const h=s("#levelSelect"),p=s("#btnStart"),b=s("#btnStop"),m=s("#btnSave");let v=!1,y=null,f=[];const L=e=>{const t=`[${(new Date).toISOString()}] [${i.textContent.trim()}] ${e}`;f.push(t),f.length>500&&f.shift(),u.textContent=f.slice(-20).join("\n")};h.addEventListener("change",(async()=>{const t=h.value;i.textContent=t,L(`Logging level set to ${t}`);const n=await c(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:t})});l(n.ok?"Set level OK":"Set level failed",n.ok?"success":"error")})),p.addEventListener("click",(async()=>{if(v)return;p.disabled=!0,p.classList.add("loading");const e=await c(t,{method:"POST"});if(p.classList.remove("loading"),!e.ok)return p.disabled=!1,void l("Start failed","error");v=!0,b.disabled=!1,b.classList.remove("btn-muted"),L("Start logging to debug.log"),y=setInterval((()=>L("IP camera heartbeat")),1500),l("Logging started","success")})),b.addEventListener("click",(async()=>{if(!v)return;b.classList.add("loading");const e=await c(n,{method:"POST"});b.classList.remove("loading"),e.ok?(v=!1,p.disabled=!1,b.disabled=!0,b.classList.add("btn-muted"),y&&clearInterval(y),L("Stop logging to debug.log"),l("Logging stopped","success")):l("Stop failed","error")})),m.addEventListener("click",(async()=>{try{const e=await c(o);if(!e||!e.blob||e instanceof Response){const t=await e.blob(),n=URL.createObjectURL(t),o=Object.assign(document.createElement("a"),{href:n,download:"debug.log"});document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(n)}else{const e=new Blob([f.join("\n")],{type:"text/plain;charset=utf-8"}),t=URL.createObjectURL(e),n=Object.assign(document.createElement("a"),{href:t,download:"debug.log"});document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(t)}l("Log saved","success")}catch{l("Save failed","error")}}))}()}function g(){localStorage.getItem("token")&&"#/login"!==location.hash?r():d()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):g(),window.addEventListener("hashchange",g)}();